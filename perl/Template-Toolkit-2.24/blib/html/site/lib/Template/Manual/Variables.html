<?xml version="1.0" ?>
<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html>
<head>
<!-- saved from url=(0017)http://localhost/ -->
<script language="JavaScript" src="../../../../displayToc.js"></script>
<script language="JavaScript" src="../../../../tocParas.js"></script>
<script language="JavaScript" src="../../../../tocTab.js"></script>
<link rel="stylesheet" type="text/css" href="../../../../scineplex.css">
<title>Template::Manual::Variables - Template variables and code bindings</title>
<link rel="stylesheet" href="../../../../Active.css" type="text/css" />
<meta http-equiv="content-type" content="text/html; charset=utf-8" />
<link rev="made" href="mailto:" />
</head>

<body>


<!-- INDEX BEGIN -->
<div name="index">
<script>writelinks('__top__',4);</script>
<h1><a>Template::Manual::Variables - Template variables and code bindings</a></h1>
<p><a name="__index__"></a></p>


<ul>

	<li><a href="#name">NAME</a></li>
	<li><a href="#template_variables">Template Variables</a></li>
	<ul>

		<li><a href="#scalar_values">Scalar Values</a></li>
		<li><a href="#hash_array_references">Hash Array References</a></li>
		<li><a href="#list_references">List References</a></li>
		<li><a href="#subroutines">Subroutines</a></li>
		<li><a href="#objects">Objects</a></li>
		<li><a href="#passing_parameters_and_returning_values">Passing Parameters and Returning Values</a></li>
		<li><a href="#error_handling">Error Handling</a></li>
	</ul>

	<li><a href="#virtual_methods">Virtual Methods</a></li>
	<li><a href="#variable_interpolation">Variable Interpolation</a></li>
	<li><a href="#local_and_global_variables">Local and Global Variables</a></li>
	<li><a href="#compile_time_constant_folding">Compile Time Constant Folding</a></li>
	<li><a href="#special_variables">Special Variables</a></li>
	<ul>

		<li><a href="#template">template</a></li>
		<li><a href="#component">component</a></li>
		<li><a href="#loop">loop</a></li>
		<li><a href="#error">error</a></li>
		<li><a href="#content">content</a></li>
	</ul>

	<li><a href="#compound_variables">Compound Variables</a></li>
</ul>

<hr name="index" />
</div>
<!-- INDEX END -->

<p>
</p>
<h1><a name="name">NAME</a></h1>
<p>Template::Manual::Variables - Template variables and code bindings</p>
<p>
</p>
<hr />
<h1><a name="template_variables">Template Variables</a></h1>
<p>A reference to a hash array may be passed as the second argument to the
<em>process()</em> method, containing definitions of template
variables. The <code>VARIABLES</code> (a.k.a. <code>PRE_DEFINE</code>) option can also be used to
pre-define variables for all templates processed by the object.</p>
<pre>
    <span class="keyword">my</span> <span class="variable">$tt</span> <span class="operator">=</span> <span class="variable">Template</span><span class="operator">-&gt;</span><span class="variable">new</span><span class="operator">(</span><span class="operator">{</span>
        <span class="string">VARIABLES</span> <span class="operator">=&gt;</span> <span class="operator">{</span>
            <span class="string">version</span> <span class="operator">=&gt;</span> <span class="number">3.14</span><span class="operator">,</span>
            <span class="string">release</span> <span class="operator">=&gt;</span> <span class="string">'Sahara'</span><span class="operator">,</span>
        <span class="operator">}</span><span class="operator">,</span>  
    <span class="operator">}</span><span class="operator">);</span>
    
    <span class="keyword">my</span> <span class="variable">$vars</span> <span class="operator">=</span> <span class="operator">{</span>
        <span class="string">serial_no</span> <span class="operator">=&gt;</span> <span class="number">271828</span><span class="operator">,</span>
    <span class="operator">}</span><span class="operator">;</span>
    
    <span class="variable">$tt</span><span class="operator">-&gt;</span><span class="variable">process</span><span class="operator">(</span><span class="string">'myfile'</span><span class="operator">,</span> <span class="variable">$vars</span><span class="operator">);</span>
</pre>
<p><em class="file">myfile</em> template:</p>
<pre>
    This is version [% version %] ([% release %]).
    Serial number: [% serial_no %]</pre>
<p>Generated Output:</p>
<pre>
    This is version 3.14 (Sahara)
    Serial number: 271828</pre>
<p>Variable names may contain any alphanumeric characters or underscores. They
may be lower, upper or mixed case although the usual convention is to use
lower case. The case <em>is</em> significant however, and '<code>foo</code>', '<code>Foo</code>' and
'<code>FOO</code>' are all different variables. Upper case variable names are permitted,
but not recommended due to a possible conflict with an existing or future
reserved word.  As of version 2.00, these are:</p>
<pre>
    GET CALL SET DEFAULT INSERT INCLUDE PROCESS WRAPPER 
    IF UNLESS ELSE ELSIF FOR FOREACH WHILE SWITCH CASE
    USE PLUGIN FILTER MACRO PERL RAWPERL BLOCK META
    TRY THROW CATCH FINAL NEXT LAST BREAK RETURN STOP 
    CLEAR TO STEP AND OR NOT MOD DIV END</pre>
<p>The variable values may be of virtually any Perl type, including
simple scalars, references to lists, hash arrays, subroutines or
objects.  The Template Toolkit will automatically apply the correct
procedure to accessing these values as they are used in the template.</p>
<p>Example data:</p>
<pre>
    <span class="keyword">my</span> <span class="variable">$vars</span> <span class="operator">=</span> <span class="operator">{</span>
        <span class="string">article</span> <span class="operator">=&gt;</span> <span class="string">'The Third Shoe'</span><span class="operator">,</span>
        <span class="string">person</span>  <span class="operator">=&gt;</span> <span class="operator">{</span> 
            <span class="string">id</span>    <span class="operator">=&gt;</span> <span class="number">314</span><span class="operator">,</span> 
            <span class="string">name</span>  <span class="operator">=&gt;</span> <span class="string">'Mr. Blue'</span><span class="operator">,</span>
            <span class="string">email</span> <span class="operator">=&gt;</span> <span class="string">'blue@nowhere.org'</span><span class="operator">,</span>
        <span class="operator">}</span><span class="operator">,</span>
        <span class="string">primes</span>  <span class="operator">=&gt;</span> <span class="operator">[</span> <span class="number">2</span><span class="operator">,</span> <span class="number">3</span><span class="operator">,</span> <span class="number">5</span><span class="operator">,</span> <span class="number">7</span><span class="operator">,</span> <span class="number">11</span><span class="operator">,</span> <span class="number">13</span> <span class="operator">]</span><span class="operator">,</span>
        <span class="string">wizard</span>  <span class="operator">=&gt;</span> <span class="keyword">sub</span><span class="variable"> </span><span class="operator">{</span> <span class="keyword">return</span> <span class="keyword">join</span><span class="operator">(</span><span class="string">' '</span><span class="operator">,</span> <span class="string">'Abracadabra!'</span><span class="operator">,</span> <span class="variable">@_</span><span class="operator">)</span> <span class="operator">},</span>
        <span class="string">cgi</span>     <span class="operator">=&gt;</span> <span class="variable">CGI</span><span class="operator">-&gt;</span><span class="variable">new</span><span class="operator">(</span><span class="string">'mode=submit&amp;debug=1'</span><span class="operator">),</span>
    <span class="operator">}</span><span class="operator">;</span>
</pre>
<p>Example template:</p>
<pre>
    [% article %]
    
    [% person.id %]: [% person.name %] &lt;[% person.email %]&gt;
    
    [% primes.first %] - [% primes.last %], including [% primes.3 %]
    [% primes.size %] prime numbers: [% primes.join(', ') %]
    
    [% wizard %]
    [% wizard('Hocus Pocus!') %]
    
    [% cgi.param('mode') %]</pre>
<p>Generated output:</p>
<pre>
    The Third Shoe
    
    314: Mr. Blue &lt;blue@nowhere.org&gt;
    
    2 - 13, including 7
    6 prime numbers: 2, 3, 5, 7, 11, 13
    
    Abracadabra!
    Abracadabra! Hocus Pocus!
    
    submit</pre>
<p>
</p>
<h2><a name="scalar_values">Scalar Values</a></h2>
<p>Regular scalar variables are accessed by simply specifying their name.
As these are just entries in the top-level variable hash they can be 
considered special cases of hash array referencing as described below,
with the main namespace hash automatically implied.</p>
<pre>
    [% article %]</pre>
<p>
</p>
<h2><a name="hash_array_references">Hash Array References</a></h2>
<p>Members of hash arrays are accessed by specifying the hash reference
and key separated by the dot '<code>.</code>' operator.</p>
<p>Example data:</p>
<pre>
    <span class="keyword">my</span> <span class="variable">$vars</span> <span class="operator">=</span> <span class="operator">{</span>
        <span class="string">'home'</span> <span class="operator">=&gt;</span> <span class="string">'http://www.myserver.com/homepage.html'</span><span class="operator">,</span>
        <span class="string">'page'</span> <span class="operator">=&gt;</span> <span class="operator">{</span>
            <span class="string">'this'</span> <span class="operator">=&gt;</span> <span class="string">'mypage.html'</span><span class="operator">,</span>
            <span class="string">'next'</span> <span class="operator">=&gt;</span> <span class="string">'nextpage.html'</span><span class="operator">,</span>
            <span class="string">'prev'</span> <span class="operator">=&gt;</span> <span class="string">'prevpage.html'</span><span class="operator">,</span>
        <span class="operator">}</span><span class="operator">,</span>
    <span class="operator">}</span><span class="operator">;</span>
</pre>
<p>Example template:</p>
<pre>
    &lt;a href=&quot;[% home %]&quot;&gt;Home&lt;/a&gt;
    &lt;a href=&quot;[% page.prev %]&quot;&gt;Previous Page&lt;/a&gt;
    &lt;a href=&quot;[% page.next %]&quot;&gt;Next Page&lt;/a&gt;</pre>
<p>Generated output:</p>
<pre>
    &lt;a href=&quot;<a href="http://www.myserver.com/homepage.html">http://www.myserver.com/homepage.html</a>&quot;&gt;Home&lt;/a&gt;
    &lt;a href=&quot;prevpage.html&quot;&gt;Previous Page&lt;/a&gt;
    &lt;a href=&quot;nextpage.html&quot;&gt;Next Page&lt;/a&gt;</pre>
<p>Any key in a hash which starts with a '<code>_</code>' or '<code>.</code>' character will be
considered private and cannot be evaluated or updated from within a
template.  The undefined value will be returned for any such variable
accessed which the Template Toolkit will silently ignore (unless the
<code>DEBUG</code> option is enabled).</p>
<p>Example data:</p>
<pre>
    <span class="keyword">my</span> <span class="variable">$vars</span> <span class="operator">=</span> <span class="operator">{</span>
        <span class="string">message</span> <span class="operator">=&gt;</span> <span class="string">'Hello World!'</span><span class="operator">,</span>
        <span class="string">_secret</span> <span class="operator">=&gt;</span> <span class="string">"On the Internet, no-one knows you're a dog"</span><span class="operator">,</span>
        <span class="string">thing</span>   <span class="operator">=&gt;</span> <span class="operator">{</span>
            <span class="string">public</span>    <span class="operator">=&gt;</span> <span class="number">123</span><span class="operator">,</span>
            <span class="string">_private</span>  <span class="operator">=&gt;</span> <span class="number">456</span><span class="operator">,</span>
            <span class="string">'.hidden'</span> <span class="operator">=&gt;</span> <span class="number">789</span><span class="operator">,</span>
        <span class="operator">}</span><span class="operator">,</span>
    <span class="operator">}</span><span class="operator">;</span>
</pre>
<p>Example template:</p>
<pre>
    [% message %]           # outputs &quot;Hello World!&quot;
    [% _secret %]           # no output
    [% thing.public %]      # outputs &quot;123&quot;
    [% thing._private %]    # no output
    [% thing..hidden %]     # ERROR: unexpected token (..)</pre>
<p>You can disable this feature by setting the <code>$Template::Stash::PRIVATE</code>
package variable to a false value.</p>
<pre>
    <span class="variable">$Template::Stash::PRIVATE</span> <span class="operator">=</span> <span class="keyword">undef</span><span class="operator">;</span>   <span class="comment"># now you can thing._private</span>
</pre>
<p>To access a hash entry using a key stored in another variable, prefix
the key variable with '<code>$</code>' to have it interpolated before use (see
<a href="#variable_interpolation">Variable Interpolation</a>).</p>
<pre>
    [% pagename = 'next' %]
    [% page.$pagename %]       # same as [% page.next %]</pre>
<p>When you assign to a variable that contains multiple namespace 
elements (i.e. it has one or more '<code>.</code>' characters in the name),
any hashes required to represent intermediate namespaces will be 
created automatically.  In this following example, the <code>product</code> 
variable automatically springs into life as a hash array unless
otherwise defined.</p>
<pre>
    [% product.id    = 'XYZ-2000' 
       product.desc  = 'Bogon Generator'
       product.price = 666 
    %]
    
    The [% product.id %] [% product.desc %] 
    costs $[% product.price %].00</pre>
<p>Generated output:</p>
<pre>
    The XYZ-2000 Bogon Generator 
    costs $666.00</pre>
<p>You can use Perl's familiar <code>{</code> ... <code>}</code> construct to explicitly create
a hash and assign it to a variable.  Note that commas are optional
between key/value pairs and <code>=</code> can be used in place of <code>=&gt;</code>.</p>
<pre>
    <span class="comment"># minimal TT style</span>
    <span class="operator">[</span><span class="operator">% </span><span class="variable">product</span> <span class="operator">=</span> <span class="operator">{</span>
         <span class="variable">id</span>    <span class="operator">=</span> <span class="string">'XYZ-2000'</span>
         <span class="variable">desc</span>  <span class="operator">=</span> <span class="string">'Bogon Generator'</span>
         <span class="variable">price</span> <span class="operator">=</span> <span class="number">666</span>
       <span class="operator">}</span>
    <span class="variable">%]</span>
</pre>
<pre>
    <span class="comment"># perl style</span>
    <span class="operator">[</span><span class="operator">% </span><span class="variable">product</span> <span class="operator">=</span> <span class="operator">{</span>
         <span class="string">id</span>    <span class="operator">=&gt;</span> <span class="string">'XYZ-2000'</span><span class="operator">,</span>
         <span class="string">desc</span>  <span class="operator">=&gt;</span> <span class="string">'Bogon Generator'</span><span class="operator">,</span>
         <span class="string">price</span> <span class="operator">=&gt;</span> <span class="number">666</span><span class="operator">,</span>
       <span class="operator">}</span>
    <span class="variable">%]</span>
</pre>
<p>
</p>
<h2><a name="list_references">List References</a></h2>
<p>Items in lists are also accessed by use of the dot operator.</p>
<p>Example data:</p>
<pre>
    <span class="keyword">my</span> <span class="variable">$vars</span> <span class="operator">=</span> <span class="operator">{</span>
        <span class="string">people</span> <span class="operator">=&gt;</span> <span class="operator">[</span> <span class="string">'Tom'</span><span class="operator">,</span> <span class="string">'Dick'</span><span class="operator">,</span> <span class="string">'Larry'</span> <span class="operator">]</span><span class="operator">,</span>
    <span class="operator">}</span><span class="operator">;</span>
</pre>
<p>Example template:</p>
<pre>
    [% people.0 %]          # Tom
    [% people.1 %]          # Dick
    [% people.2 %]          # Larry</pre>
<p>The <code>FOREACH</code> directive can be used to iterate through items in a list.</p>
<pre>
    [% FOREACH person IN people %]
    Hello [% person %]
    [% END %]</pre>
<p>Generated output:</p>
<pre>
    Hello Tom
    Hello Dick
    Hello Larry</pre>
<p>Lists can be constructed in-situ using the regular anonymous list
<code>[</code> ... <code>]</code> construct.  Commas between items are optional.</p>
<pre>
    [% cols = [ 'red', 'green', 'blue' ] %]
    
    [% FOREACH c IN cols %]
       [% c %]
    [% END %]</pre>
<p>or:</p>
<pre>
    [% FOREACH c IN [ 'red', 'green', 'blue' ] %]
       [% c %]
    [% END %]</pre>
<p>You can also create simple numerical sequences using the <code>..</code> range
operator:</p>
<pre>
    [% n = [ 1 .. 4 ] %]    # n is [ 1, 2, 3, 4 ] 
    
    [% x = 4
       y = 8
       z = [x..y]           # z is [ 4, 5, 6, 7, 8 ]
    %]</pre>
<p>
</p>
<h2><a name="subroutines">Subroutines</a></h2>
<p>Template variables can contain references to Perl subroutines.  When
the variable is used, the Template Toolkit will automatically call the
subroutine, passing any additional arguments specified.  The return
value from the subroutine is used as the variable value and inserted
into the document output.</p>
<pre>
    <span class="keyword">my</span> <span class="variable">$vars</span> <span class="operator">=</span> <span class="operator">{</span>
        <span class="string">wizard</span>  <span class="operator">=&gt;</span> <span class="keyword">sub</span><span class="variable"> </span><span class="operator">{</span> <span class="keyword">return</span> <span class="keyword">join</span><span class="operator">(</span><span class="string">' '</span><span class="operator">,</span> <span class="string">'Abracadabra!'</span><span class="operator">,</span> <span class="variable">@_</span><span class="operator">)</span> <span class="operator">},</span>
    <span class="operator">}</span><span class="operator">;</span>
</pre>
<p>Example template:</p>
<pre>
    [% wizard %]                    # Abracadabra!
    [% wizard('Hocus Pocus!') %]    # Abracadabra! Hocus Pocus!</pre>
<p>
</p>
<h2><a name="objects">Objects</a></h2>
<p>Template variables can also contain references to Perl objects.
Methods are called using the dot operator to specify the method
against the object variable.  Additional arguments can be specified
as with subroutines.</p>
<pre>
    <span class="keyword">use</span> <span class="variable">CGI</span><span class="operator">;</span>
    
    <span class="keyword">my</span> <span class="variable">$vars</span> <span class="operator">=</span> <span class="operator">{</span>
        <span class="comment"># hard coded CGI params for purpose of example</span>
        <span class="string">cgi</span>  <span class="operator">=&gt;</span> <span class="variable">CGI</span><span class="operator">-&gt;</span><span class="variable">new</span><span class="operator">(</span><span class="string">'mode=submit&amp;debug=1'</span><span class="operator">),</span>
    <span class="operator">}</span><span class="operator">;</span>
</pre>
<p>Example template:</p>
<pre>
    [% FOREACH p IN cgi.param %]     # returns list of param keys
    [% p %] =&gt; [% cgi.param(p) %]   # fetch each param value
    [% END %]</pre>
<p>Generated output:</p>
<pre>
    mode =&gt; submit
    debug =&gt; 1</pre>
<p>Object methods can also be called as lvalues.  That is, they can appear on 
the left side of an assignment.  The method will be called passing the 
assigning value as an argument.</p>
<pre>
    [% myobj.method = 10 %]</pre>
<p>equivalent to:</p>
<pre>
    [% myobj.method(10) %]</pre>
<p>
</p>
<h2><a name="passing_parameters_and_returning_values">Passing Parameters and Returning Values</a></h2>
<p>Subroutines and methods will be passed any arguments specified in the
template.  Any template variables in the argument list will first be
evaluated and their resultant values passed to the code.</p>
<pre>
    <span class="keyword">my</span> <span class="variable">$vars</span> <span class="operator">=</span> <span class="operator">{</span>
        <span class="string">mycode</span> <span class="operator">=&gt;</span> <span class="keyword">sub</span><span class="variable"> </span><span class="operator">{</span> <span class="keyword">return</span> <span class="string">'received '</span> <span class="operator">.</span> <span class="keyword">join</span><span class="operator">(</span><span class="string">', '</span><span class="operator">,</span> <span class="variable">@_</span><span class="operator">)</span> <span class="operator">},</span>
    <span class="operator">}</span><span class="operator">;</span>
</pre>
<p>template:</p>
<pre>
    [% foo = 10 %]
    [% mycode(foo, 20) %]       # received 10, 20</pre>
<p>Named parameters may also be specified.  These are automatically collected
into a single hash array which is passed by reference as the <strong>last</strong> 
parameter to the sub-routine.  Named parameters can be specified using
either <code>=&gt;</code> or <code>=</code> and can appear anywhere in the argument list.</p>
<pre>
    <span class="keyword">my</span> <span class="variable">$vars</span> <span class="operator">=</span> <span class="operator">{</span>
        <span class="string">myjoin</span> <span class="operator">=&gt;</span> <span class="operator">\&amp;</span><span class="variable">myjoin</span><span class="operator">,</span>
    <span class="operator">}</span><span class="operator">;</span>
    
    <span class="keyword">sub</span><span class="variable"> myjoin </span><span class="operator">{</span>
        <span class="comment"># look for hash ref as last argument</span>
        <span class="keyword">my</span> <span class="variable">$params</span> <span class="operator">=</span> <span class="keyword">ref</span> <span class="variable">$_</span><span class="operator">[</span><span class="operator">-</span><span class="number">1</span><span class="operator">]</span> <span class="keyword">eq</span> <span class="string">'HASH'</span> <span class="operator">?</span> <span class="keyword">pop</span> <span class="operator">:</span> <span class="operator">{</span> <span class="operator">}</span><span class="operator">;</span>
        <span class="keyword">return</span> <span class="keyword">join</span><span class="operator">(</span><span class="variable">$params</span><span class="operator">-&gt;</span><span class="operator">{</span> <span class="variable">joint</span> <span class="operator">}</span> <span class="operator">||</span> <span class="string">' + '</span><span class="operator">,</span> <span class="variable">@_</span><span class="operator">);</span>
    <span class="operator">}</span>
</pre>
<p>Example template:</p>
<pre>
    [% myjoin(10, 20, 30) %]
    [% myjoin(10, 20, 30, joint = ' - ' %]
    [% myjoin(joint =&gt; ' * ', 10, 20, 30 %]</pre>
<p>Generated output:</p>
<pre>
    10 + 20 + 30
    10 - 20 - 30
    10 * 20 * 30</pre>
<p>Parenthesised parameters may be added to any element of a variable,
not just those that are bound to code or object methods.  At present,
parameters will be ignored if the variable isn't &quot;callable&quot; but are 
supported for future extensions.  Think of them as &quot;hints&quot; to that 
variable, rather than just arguments passed to a function.</p>
<pre>
    [% r = 'Romeo' %]
    [% r(100, 99, s, t, v) %]       # outputs &quot;Romeo&quot;</pre>
<p>User code should return a value for the variable it represents. This
can be any of the Perl data types described above: a scalar, or
reference to a list, hash, subroutine or object.  Where code returns a
list of multiple values the items will automatically be folded into a
list reference which can be accessed as per normal.</p>
<pre>
    <span class="keyword">my</span> <span class="variable">$vars</span> <span class="operator">=</span> <span class="operator">{</span>
        <span class="comment"># either is OK, first is recommended</span>
        <span class="string">items1</span> <span class="operator">=&gt;</span> <span class="keyword">sub</span><span class="variable"> </span><span class="operator">{</span> <span class="keyword">return</span> <span class="operator">[</span> <span class="string">'foo'</span><span class="operator">,</span> <span class="string">'bar'</span><span class="operator">,</span> <span class="string">'baz'</span> <span class="operator">]</span> <span class="operator">},</span>
        <span class="string">items2</span> <span class="operator">=&gt;</span> <span class="keyword">sub</span><span class="variable"> </span><span class="operator">{</span> <span class="keyword">return</span> <span class="operator">(</span> <span class="string">'foo'</span><span class="operator">,</span> <span class="string">'bar'</span><span class="operator">,</span> <span class="string">'baz'</span> <span class="operator">)</span> <span class="operator">},</span>
    <span class="operator">}</span><span class="operator">;</span>
</pre>
<p>Example template:</p>
<pre>
    [% FOREACH i IN items1 %]
       ...
    [% END %]
    
    [% FOREACH i IN items2 %]
       ...
    [% END %]</pre>
<p>
</p>
<h2><a name="error_handling">Error Handling</a></h2>
<p>Errors can be reported from user code by calling <a href="../../../../lib/pods/perlfunc.html#die"><code>die()</code></a>.  Errors raised
in this way are caught by the Template Toolkit and converted to
structured exceptions which can be handled from within the template.
A reference to the exception object is then available as the <code>error</code>
variable.</p>
<pre>
    <span class="keyword">my</span> <span class="variable">$vars</span> <span class="operator">=</span> <span class="operator">{</span>
        <span class="string">barf</span> <span class="operator">=&gt;</span> <span class="keyword">sub</span><span class="variable"> </span><span class="operator">{</span> 
            <span class="keyword">die</span> <span class="string">"a sick error has occurred\n"</span><span class="operator">;</span>
        <span class="operator">},</span>
    <span class="operator">}</span><span class="operator">;</span>
</pre>
<p>Example template:</p>
<pre>
    [% TRY %]
       [% barf %]       # calls sub which throws error via die()
    [% CATCH %]
       [% error.info %]     # outputs &quot;a sick error has occurred\n&quot;
    [% END %]</pre>
<p>Error messages thrown via <a href="../../../../lib/pods/perlfunc.html#die"><code>die()</code></a> are converted to exceptions of type
<a href="../../../../lib/pods/perlfunc.html#undef"><code>undef</code></a> (the literal string &quot;undef&quot; rather than the undefined value).
Exceptions of user-defined types can be thrown by calling <a href="../../../../lib/pods/perlfunc.html#die"><code>die()</code></a> with 
a reference to a <a href="../../../..//Develop/Perl/Template-Toolkit-2.24/blib/html/site/lib/Template/Exception.html">the Template::Exception manpage</a> object.</p>
<pre>
    <span class="keyword">use</span> <span class="variable">Template::Exception</span><span class="operator">;</span>
    
    <span class="keyword">my</span> <span class="variable">$vars</span> <span class="operator">=</span> <span class="operator">{</span>
        <span class="string">login</span> <span class="operator">=&gt;</span> <span class="keyword">sub</span><span class="variable"> </span><span class="operator">{</span> 
            <span class="operator">...</span><span class="keyword">do</span> <span class="variable">something</span><span class="operator">...</span>
            <span class="keyword">die</span> <span class="variable">Template::Exception</span><span class="operator">-&gt;</span><span class="variable">new</span><span class="operator">(</span> <span class="string">badpwd</span> <span class="operator">=&gt;</span> <span class="string">'password too silly'</span> <span class="operator">);</span>
        <span class="operator">},</span>
    <span class="operator">}</span><span class="operator">;</span>
</pre>
<p>Example template:</p>
<pre>
    [% TRY %]
       [% login %]
    [% CATCH badpwd %]
       Bad password: [% error.info %]
    [% CATCH %]
       Some other '[% error.type %]' error: [% error.info %]
    [% END %]</pre>
<p>The exception types <code>stop</code> and <a href="../../../../lib/pods/perlfunc.html#return"><code>return</code></a> are used to implement the 
<code>STOP</code> and <code>RETURN</code> directives.  Throwing an exception as:</p>
<pre>
    <span class="keyword">die</span> <span class="operator">(</span><span class="variable">Template::Exception</span><span class="operator">-&gt;</span><span class="variable">new</span><span class="operator">(</span><span class="string">'stop'</span><span class="operator">));</span>
</pre>
<p>has the same effect as the directive:</p>
<pre>
    [% STOP %]</pre>
<p>
</p>
<hr />
<h1><a name="virtual_methods">Virtual Methods</a></h1>
<p>The Template Toolkit implements a number of &quot;virtual methods&quot; which 
can be applied to scalars, hashes or lists.  For example:</p>
<pre>
    [% mylist = [ 'foo', 'bar', 'baz' ] %]
    [% newlist = mylist.sort %]</pre>
<p>Here <code>mylist</code> is a regular reference to a list, and 'sort' is 
a virtual method that returns a new list of the items in sorted 
order.  You can chain multiple virtual methods together.  For
example:</p>
<pre>
    [% mylist.sort.join(', ') %]</pre>
<p>Here the <a href="../../../../lib/pods/perlfunc.html#join"><code>join</code></a> virtual method is called to join the sorted list into
a single string, generating the following output:</p>
<pre>
    bar, baz, foo</pre>
<p>See <a href="../../../..//Develop/Perl/Template-Toolkit-2.24/blib/html/site/lib/Template/Manual/VMethods.html">the Template::Manual::VMethods manpage</a> for details of all the virtual 
methods available.</p>
<p>
</p>
<hr />
<h1><a name="variable_interpolation">Variable Interpolation</a></h1>
<p>The Template Toolkit uses <code>$</code> consistently to indicate that a variable
should be interpolated in position.  Most frequently, you see this in 
double-quoted strings:</p>
<pre>
    [% fullname = &quot;$honorific $firstname $surname&quot; %]</pre>
<p>Or embedded in plain text when the <code>INTERPOLATE</code> option is set:</p>
<pre>
    Dear $honorific $firstname $surname,</pre>
<p>The same rules apply within directives.  If a variable is prefixed
with a <code>$</code> then it is replaced with its value before being used.  The
most common use is to retrieve an element from a hash where the key is
stored in a variable.</p>
<pre>
    [% uid = 'abw' %]
    [% users.$uid %]         # same as 'userlist.abw'</pre>
<p>Curly braces can be used to delimit interpolated variable names where
necessary.</p>
<pre>
    <span class="operator">[</span><span class="operator">% </span><span class="variable">users</span><span class="operator">.</span><span class="variable">$</span><span class="operator">{</span><span class="variable">me</span><span class="operator">.</span><span class="variable">id</span><span class="operator">}</span><span class="operator">.</span><span class="variable">name</span> <span class="variable">%]</span>
</pre>
<p>Directives such as <code>INCLUDE</code>, <code>PROCESS</code>, etc., that accept a template name
as the first argument, will automatically quote it for convenience.</p>
<pre>
    [% INCLUDE foo/bar.txt %]</pre>
<p>The above example is equivalent to:</p>
<pre>
    [% INCLUDE &quot;foo/bar.txt&quot; %]</pre>
<p>To <code>INCLUDE</code> a template whose name is stored in a variable, simply
prefix the variable name with <code>$</code> to have it interpolated.</p>
<pre>
    [% myfile = 'header' %]
    [% INCLUDE $myfile %]</pre>
<p>This is equivalent to:</p>
<pre>
    [% INCLUDE header %]</pre>
<p>Note also that a variable containing a reference to a <a href="../../../..//Develop/Perl/Template-Toolkit-2.24/blib/html/site/lib/Template/Document.html">the Template::Document manpage</a>
object can also be processed in this way.</p>
<pre>
    <span class="keyword">my</span> <span class="variable">$vars</span> <span class="operator">=</span> <span class="operator">{</span>
        <span class="string">header</span> <span class="operator">=&gt;</span> <span class="variable">Template::Document</span><span class="operator">-&gt;</span><span class="variable">new</span><span class="operator">(</span><span class="operator">{</span> <span class="operator">...</span> <span class="operator">}</span><span class="operator">),</span>
    <span class="operator">}</span><span class="operator">;</span>
</pre>
<p>Example template:</p>
<pre>
    [% INCLUDE $header %]</pre>
<p>
</p>
<hr />
<h1><a name="local_and_global_variables">Local and Global Variables</a></h1>
<p>Any simple variables that you create, or any changes you make to
existing variables, will only persist while the template is being
processed.  The top-level variable hash is copied before processing
begins and any changes to variables are made in this copy, leaving the
original intact.</p>
<p>The same thing happens when you <code>INCLUDE</code> another template. The current
namespace hash is cloned to prevent any variable changes made in the included
template from interfering with existing variables. The <code>PROCESS</code> option bypasses
the localisation step altogether making it slightly faster, but requiring
greater attention to the possibility of side effects caused by creating or
changing any variables within the processed template.</p>
<pre>
    [% BLOCK change_name %]
       [% name = 'bar' %]
    [% END %]
    
    [% name = 'foo' %] 
    [% INCLUDE change_name %]
    [% name %]              # foo
    [% PROCESS change_name %]
    [% name %]              # bar</pre>
<p>Dotted compound variables behave slightly differently because the
localisation process is only skin deep.  The current variable
namespace hash is copied, but no attempt is made to perform a
deep-copy of other structures within it (hashes, arrays, objects,
etc).  A variable referencing a hash, for example, will be copied to
create a new reference but which points to the same hash.  Thus, the
general rule is that simple variables (undotted variables) are
localised, but existing complex structures (dotted variables) are not.</p>
<pre>
    <span class="operator">[</span><span class="operator">% </span><span class="variable">BLOCK</span> <span class="variable">all_change</span> <span class="variable">%]</span>
       <span class="operator">[</span><span class="operator">% x</span> <span class="operator">=</span> <span class="number">20</span> <span class="variable">%]</span>         <span class="comment"># changes copy</span>
       <span class="operator">[</span><span class="operator">% </span><span class="regex">y.z = 'zulu' %]       # changes original
    [% END %]
    
    [% x = 10
       y = { z =&gt; 'zebra' }
    %]
    [% INCLUDE all_change %]
    [% x %]             # still '10'
    [% y.z %]               # now 'zulu'
    </span>
</pre>
<p>If you create a complex structure such as a hash or list reference
within a local template context then it will cease to exist when 
the template is finished processing.</p>
<pre>
    <span class="operator">[</span><span class="operator">% </span><span class="variable">BLOCK</span> <span class="variable">new_stuff</span> <span class="variable">%]</span>
       <span class="operator">[</span><span class="operator">% </span><span class="comment"># define a new 'y' hash array in local context</span>
          <span class="regex">y = { z =&gt; 'zulu' }
       %]
    [% END %]
    
    [% x =</span> <span class="number">10</span> <span class="variable">%]</span>
    <span class="operator">[</span><span class="operator">% </span><span class="variable">INCLUDE</span> <span class="variable">new_stuff</span> <span class="variable">%]</span>
    <span class="operator">[</span><span class="operator">% x</span> <span class="variable">%]</span>             <span class="comment"># outputs '10'</span>
    <span class="operator">[</span><span class="operator">% </span><span class="regex">y %]             # nothing, y is undefined
    </span>
</pre>
<p>Similarly, if you update an element of a compound variable which
<em>doesn't</em> already exists then a hash will be created automatically
and deleted again at the end of the block.</p>
<pre>
    [% BLOCK new_stuff %]
       [% y.z = 'zulu' %]
    [% END %]</pre>
<p>However, if the hash <em>does</em> already exist then you will modify the
original with permanent effect.  To avoid potential confusion, it is
recommended that you don't update elements of complex variables from
within blocks or templates included by another.</p>
<p>If you want to create or update truly global variables then you can 
use the 'global' namespace.  This is a hash array automatically created
in the top-level namespace which all templates, localised or otherwise
see the same reference to.  Changes made to variables within this
hash are visible across all templates.</p>
<pre>
    [% global.version = 123 %]</pre>
<p>
</p>
<hr />
<h1><a name="compile_time_constant_folding">Compile Time Constant Folding</a></h1>
<p>In addition to variables that get resolved each time a template is
processed, you can also define variables that get resolved just once
when the template is compiled.  This generally results in templates
processing faster because there is less work to be done.</p>
<p>To define compile-time constants, specify a <code>CONSTANTS</code> hash as a
constructor item as per <code>VARIABLES</code>.  The <code>CONSTANTS</code> hash can contain any
kind of complex, nested, or dynamic data structures, just like regular
variables.</p>
<pre>
    <span class="keyword">my</span> <span class="variable">$tt</span> <span class="operator">=</span> <span class="variable">Template</span><span class="operator">-&gt;</span><span class="variable">new</span><span class="operator">(</span><span class="operator">{</span>
        <span class="string">CONSTANTS</span> <span class="operator">=&gt;</span> <span class="operator">{</span>
            <span class="string">version</span> <span class="operator">=&gt;</span> <span class="number">3.14</span><span class="operator">,</span>
            <span class="string">release</span> <span class="operator">=&gt;</span> <span class="string">'skyrocket'</span><span class="operator">,</span>
            <span class="string">col</span>     <span class="operator">=&gt;</span> <span class="operator">{</span>
                <span class="string">back</span> <span class="operator">=&gt;</span> <span class="string">'#ffffff'</span><span class="operator">,</span>
                <span class="string">fore</span> <span class="operator">=&gt;</span> <span class="string">'#000000'</span><span class="operator">,</span>
            <span class="operator">}</span><span class="operator">,</span>
            <span class="string">myobj</span> <span class="operator">=&gt;</span> <span class="variable">My::Object</span><span class="operator">-&gt;</span><span class="variable">new</span><span class="operator">(),</span>
            <span class="string">mysub</span> <span class="operator">=&gt;</span> <span class="keyword">sub</span><span class="variable"> </span><span class="operator">{</span> <span class="operator">...</span> <span class="operator">},</span>
            <span class="string">joint</span> <span class="operator">=&gt;</span> <span class="string">', '</span><span class="operator">,</span>
        <span class="operator">}</span><span class="operator">,</span>
    <span class="operator">}</span><span class="operator">);</span>
</pre>
<p>Within a template, you access these variables using the <code>constants</code>
namespace prefix.</p>
<pre>
    Version [% constants.version %] ([% constants.release %])
    Background: [% constants.col.back %]</pre>
<p>When the template is compiled, these variable references are replaced
with the corresponding value.  No further variable lookup is then 
required when the template is processed.</p>
<p>You can call subroutines, object methods, and even virtual methods on
constant variables.</p>
<pre>
    [% constants.mysub(10, 20) %]
    [% constants.myobj(30, 40) %]
    [% constants.col.keys.sort.join(', ') %]</pre>
<p>One important proviso is that any arguments you pass to subroutines
or methods must also be literal values or compile time constants.</p>
<p>For example, these are both fine:</p>
<pre>
    # literal argument
    [% constants.col.keys.sort.join(', ') %]
    
    # constant argument
    [% constants.col.keys.sort.join(constants.joint) %]</pre>
<p>But this next example will raise an error at parse time because
<code>joint</code> is a runtime variable and cannot be determined at compile
time.</p>
<pre>
    # ERROR: runtime variable argument!
    [% constants.col.keys.sort.join(joint) %]</pre>
<p>The <code>CONSTANTS_NAMESPACE</code> option can be used to provide a different 
namespace prefix for constant variables.  For example:</p>
<pre>
    <span class="keyword">my</span> <span class="variable">$tt</span> <span class="operator">=</span> <span class="variable">Template</span><span class="operator">-&gt;</span><span class="variable">new</span><span class="operator">(</span><span class="operator">{</span>
        <span class="string">CONSTANTS</span> <span class="operator">=&gt;</span> <span class="operator">{</span>
            <span class="string">version</span> <span class="operator">=&gt;</span> <span class="number">3.14</span><span class="operator">,</span>
            <span class="comment"># ...etc...</span>
        <span class="operator">}</span><span class="operator">,</span>
        <span class="string">CONSTANTS_NAMESPACE</span> <span class="operator">=&gt;</span> <span class="string">'const'</span><span class="operator">,</span>
    <span class="operator">}</span><span class="operator">);</span>
</pre>
<p>Constants would then be referenced in templates as:</p>
<pre>
    [% const.version %]</pre>
<p>
</p>
<hr />
<h1><a name="special_variables">Special Variables</a></h1>
<p>A number of special variables are automatically defined by the Template 
Toolkit.</p>
<p>
</p>
<h2><a name="template">template</a></h2>
<p>The <code>template</code> variable contains a reference to the main template being
processed, in the form of a <a href="../../../..//Develop/Perl/Template-Toolkit-2.24/blib/html/site/lib/Template/Document.html">the Template::Document manpage</a> object. This variable is
correctly defined within <code>PRE_PROCESS</code>, <code>PROCESS</code> and <code>POST_PROCESS</code>
templates, allowing standard headers, footers, etc., to access metadata items
from the main template. The <code>name</code> and <code>modtime</code> metadata items are
automatically provided, giving the template name and modification time in
seconds since the epoch.</p>
<p>Note that the <code>template</code> variable always references the top-level
template, even when processing other template components via <code>INCLUDE</code>,
<code>PROCESS</code>, etc.</p>
<p>
</p>
<h2><a name="component">component</a></h2>
<p>The <code>component</code> variable is like <code>template</code> but always contains a
reference to the current, innermost template component being processed.
In the main template, the <code>template</code> and <code>component</code> variable will 
reference the same <a href="../../../..//Develop/Perl/Template-Toolkit-2.24/blib/html/site/lib/Template/Document.html">the Template::Document manpage</a> object.  In any other template
component called from the main template, the <code>template</code> variable 
will remain unchanged, but <code>component</code> will contain a new reference
to the current component.</p>
<p>This example should demonstrate the difference:</p>
<pre>
    <span class="variable">$template</span><span class="operator">-&gt;</span><span class="variable">process</span><span class="operator">(</span><span class="string">'foo'</span><span class="operator">)</span>
        <span class="operator">||</span> <span class="keyword">die</span> <span class="variable">$template</span><span class="operator">-&gt;</span><span class="variable">error</span><span class="operator">(),</span> <span class="string">"\n"</span><span class="operator">;</span>
</pre>
<p><em class="file">foo</em> template:</p>
<pre>
    [% template.name %]         # foo
    [% component.name %]        # foo
    [% PROCESS footer %]</pre>
<p><em class="file">footer</em> template:</p>
<pre>
    [% template.name %]         # foo
    [% component.name %]        # footer</pre>
<p>Additionally, the <code>component</code> variable has two special fields:
<a href="../../../../lib/pods/perlfunc.html#caller"><code>caller</code></a> and <code>callers</code>.  <a href="../../../../lib/pods/perlfunc.html#caller"><code>caller</code></a> contains the name of the template
that called the current template (or undef if the values of <code>template</code>
and <code>component</code> are the same).  <code>callers</code> contains a reference to a
list of all the templates that have been called on the road to calling
the current component template (like a call stack), with the
outer-most template first.</p>
<p>Here's an example:</p>
<p><em class="file">outer.tt2</em> template:</p>
<pre>
    [% component.name %]        # 'outer.tt2'
    [% component.caller %]      # undef
    [% component.callers %]     # undef
    [% PROCESS 'middle.tt2' %]</pre>
<p><em class="file">middle.tt2</em> template:</p>
<pre>
    [% component.name %]        # 'middle.tt2'
    [% component.caller %]      # 'outer.tt2'
    [% component.callers %]     # [ 'outer.tt2' ]
    [% PROCESS 'inner.tt2' %]</pre>
<p><em class="file">inner.tt2</em> template:</p>
<pre>
    [% component.name %]        # 'inner.tt2'
    [% component.caller %]      # 'middle.tt2'
    [% component.callers %]     # [ 'outer.tt2', 'middle.tt2' ]</pre>
<p>
</p>
<h2><a name="loop">loop</a></h2>
<p>Within a <code>FOREACH</code> loop, the <code>loop</code> variable references the 
<a href="../../../..//Develop/Perl/Template-Toolkit-2.24/blib/html/site/lib/Template/Iterator.html">the Template::Iterator manpage</a> object responsible for controlling the loop.</p>
<pre>
    [% FOREACH item = [ 'foo', 'bar', 'baz' ] -%]
       [% &quot;Items:\n&quot; IF loop.first -%]
       [% loop.count %]/[% loop.size %]: [% item %]
    [% END %]</pre>
<p>
</p>
<h2><a name="error">error</a></h2>
<p>Within a <code>CATCH</code> block, the <code>error</code> variable contains a reference to the 
<a href="../../../..//Develop/Perl/Template-Toolkit-2.24/blib/html/site/lib/Template/Exception.html">the Template::Exception manpage</a> object thrown from within the <code>TRY</code> block.  The 
<code>type</code> and <code>info</code> methods can be called or the variable itself can 
be printed for automatic stringification into a message of the form
&quot;<code>$type error - $info</code>&quot;.  See <a href="../../../..//Develop/Perl/Template-Toolkit-2.24/blib/html/site/lib/Template/Exception.html">the Template::Exception manpage</a> for further details.</p>
<pre>
    [% TRY %]
       ...
    [% CATCH %]
       [% error %]
    [% END %]</pre>
<p>
</p>
<h2><a name="content">content</a></h2>
<p>The <code>WRAPPER</code> method captures the output from a template block and then 
includes a named template, passing the captured output as the 'content'
variable.</p>
<pre>
    <span class="operator">[</span><span class="operator">% </span><span class="variable">WRAPPER</span> <span class="variable">box</span> <span class="variable">%]</span>
    <span class="variable">Be</span> <span class="keyword">not</span> <span class="variable">afeard</span><span class="operator">;</span> <span class="variable">the</span> <span class="variable">isle</span> <span class="variable">is</span> <span class="variable">full</span> <span class="variable">of</span> <span class="variable">noises</span><span class="operator">,</span>
    <span class="variable">Sounds</span> <span class="keyword">and</span> <span class="variable">sweet</span> <span class="variable">airs</span><span class="operator">,</span> <span class="variable">that</span> <span class="variable">give</span> <span class="variable">delight</span> <span class="keyword">and</span> <span class="variable">hurt</span> <span class="keyword">not</span><span class="operator">.</span>
    <span class="operator">[</span><span class="operator">% </span><span class="keyword">END</span> <span class="variable">%]</span>
</pre>
<pre>
    [% BLOCK box %]
    &lt;blockquote class=&quot;prose&quot;&gt;
      [% content %]
    &lt;/blockquote&gt;
    [% END %]</pre>
<p>
</p>
<hr />
<h1><a name="compound_variables">Compound Variables</a></h1>
<p>Compound 'dotted' variables may contain any number of separate
elements.  Each element may evaluate to any of the permitted variable
types and the processor will then correctly use this value to evaluate
the rest of the variable.  Arguments may be passed to any of the
intermediate elements.</p>
<pre>
    [% myorg.people.sort('surname').first.fullname %]</pre>
<p>Intermediate variables may be used and will behave entirely as expected.</p>
<pre>
    [% sorted = myorg.people.sort('surname') %]
    [% sorted.first.fullname %]</pre>
<p>This simplified dotted notation has the benefit of hiding the
implementation details of your data.  For example, you could implement
a data structure as a hash array one day and then change it to an
object the next without requiring any change to the templates.</p>

</body>

</html>
